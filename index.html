<html>
<head>
<link rel='stylesheet' type='text/css' href='css/style.css'>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src='js/d3.v4.min.js'></script>
<script src='js/dimple.v2.3.0.min.js'></script>
<script src="js/scripts.js"></script>


</head>

<body>

  <script type='text/javascript'>
  //2013-09-14 18:38:39.097000000
  console.time("TotalTime:");
  //d3.csv('data/smallparsedData.csv', draw);
  //d3.csv('data/smallparsedData.csv', function(d){
  d3.csv('data/medParsedData.csv', function(d){
    //debugger;
    dfor = d3.timeFormat('%Y-%m');
    mopar = d3.timeParse('%m')
    for (i=0; i<d.length; i++){
      
      //add conditional for inconsisttant  date and time format in data
      (d[i]['ListingCreationDate'].length > 19) ? dpar = d3.timeParse('%Y-%m-%d %H:%M:%S.%L%L%L') : dpar = d3.timeParse('%Y-%m-%d %H:%M:%S');
      
      //Create additoinal feilds that will help in processing the data
      d[i]['LoanQuarter'] = returnQuarter(dpar(d[i]['ListingCreationDate']));
      d[i]['LoanYear'] = new Date(dpar(d[i]['ListingCreationDate']).getFullYear(), 0, 1); 
      

      //cast date back to string from date function with new format
      d[i]['ListingCreationDate'] = dfor(dpar(d[i]['ListingCreationDate'])) ;
    
      
      function returnQuarter(loanDate){
        // Create the quarter data  by rounding up to next int for devisor
        // The date constructor's Month is zero indexed so  subtract 1 from it
        return new Date(loanDate.getFullYear(), (Math.ceil(dpar(loanDate.getMonth()/3))-1), 1);
      }

    }
    
    console.log(d.columns);
    draw(d);
  });
  console.timeEnd("TotalTime:");


  </script>
  

  <div id='headerContainer'>
  </div>

  <div id='chartContainer'>
    <table>
      <tr>
        <td id='chartArea' span=2> </td>
        <td id='chartDetails' span=1>  </td>
      </tr>
    </table>
  </div>

</body>
</html>
